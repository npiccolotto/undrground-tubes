<!DOCTYPE html>

<HEAD>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.js" crossorigin="anonymous"
    referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.25.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.16.3"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.22.2"></script>
</HEAD>

<body>
  <!--
  <!--<object id="drawing" src="static/drawing_0.svg" type="image/svg+xml">
  </object>-->
  <div class="container-fluid">
    <div class="row">
      <div class="col col-md-6">
        <div class="row">
          <div class="col col-md-12">
            {% for s in selection %}
            <span class="legend-item legend-item-{{loop.index}}">{{s}}</span>
            {% endfor %}
          </div>
        </div>
        <div class="row">
          {{svg_inline|safe}}
        </div>
      </div>
      <div class="col col-md-6">
        <div class="p-1">
          <h2>UnDRground Tubes</h2>
          <form action="/">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="cardinalities-tab" data-bs-toggle="tab"
                  data-bs-target="#cardinalities" type="button" role="tab" aria-controls="home"
                  aria-selected="true">Cardinalities</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button"
                  role="tab" aria-controls="profile" aria-selected="false">Advanced Settings</button>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="cardinalities" role="tabpanel" aria-labelledby="cardinalities-tab">
                <div class="form-group">
                  <select multiple class="form-select" id="set_selection" style="display:none;" id="selection"
                    name="selection">
                    {% for s in sets %}
                    <option value="{{s}}" {% if s in selection %} selected="selected" {% endif %}>{{s}}</option>
                    {% endfor %}
                  </select>
                  <div id="vis"></div>
                  <div>
                    <p id="vis-text"></p>
                  </div>
                </div>
              </div>

              <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                <div class="form-group">
                  <label for="weight">Weighting Element to Set Similarity</label>
                  <input type="range" class="form-control" id="weight" name="weight" min="0" max="1" value="{{weight}}"
                    step=".1" />
                </div>
                <div class="form-group mt-3">
                  <label for="cols">Grid Columns</label>
                  <input type="number" class="form-control" id="cols" name="cols" min="4" max="100" value="{{cols}}" />
                </div>
                <div class="form-group">
                  <label for="rows">Grid Rows</label>
                  <input type="number" class="form-control" id="rows" name="rows" min="4" max="100" value="{{rows}}" />
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="support" id="supportpath" value="supportpath" {% if
                    not treesupport %}checked {% endif %}>
                  <label class="form-check-label" for="supportpath">
                    Path
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="support" id="supporttree" value="supporttree" {% if
                    treesupport %}checked {% endif %}>
                  <label class="form-check-label" for="supporttree">
                    Tree
                  </label>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" name="optConnect" id="optConnect" {% if
                    optConnect %}checked {% endif %}>
                  <label class="form-check-label" for="optConnect">Optimal Routing</label>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" name="optRoute" id="optRoute" {% if
                    optRouter %} checked {% endif %}>
                  <label class="form-check-label" for="optRoute">Optimal Drawing</label>
                </div>
              </div>

              <div class="mt-3">
                <button type="submit">Update</button>
              </div>
          </form>
        </div>
      </div>
    </div>
  </div>


  <script>
    function ready(fn) {
      if (document.readyState !== 'loading') {
        fn();
        return;
      }
      document.addEventListener('DOMContentLoaded', fn);
    }
    ready(function () {
      var panZoomTiger = svgPanZoom('svg', {
        zoomEnabled: true,
        controlIconsEnabled: true,
        fit: true,
        center: true,
      });

      function updateVisText() {
        document.querySelector('#vis-text').textContent = Array.from(document.querySelectorAll('option[selected="selected"]')).map((option) => option.getAttribute('value')).join(', ')
      }
      let spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "description": "A simple bar chart with embedded data.",
        "width": 800,
        "mark": { "type": "bar", "orient": "vertical" , "tooltip": true},
        "encoding": {
          "color": {
            "field": "type", "type": "ordinal",
              "scale": {
                "domain": ["low", "mid", "high", "kernel"],
                "range": ["#67a9cf", "#f7f7f7", "#ef8a62", "black"]
              }
          },
          "x": {
            "field": "name",
            "type": "nominal",
            "sort": { "field": "sort_order", "order": "descending" },
            "axis": { "labelAngle": -45 , "labelFontSize": 8}
          },
          "y": { "field": "count", "type": "quantitative" }
        }
      };
      spec.data = { values: {{ set_size_json | safe }} };
      vegaEmbed('#vis', spec).then(({spec, view}) => {
          view.addEventListener('click', function (event, item) {
            if (!item.datum) {
              return
            }
            let qs = 'option[value="' + item.datum.name + '"]'
            let el = document.querySelector(qs);
            let selected = el.getAttribute('selected')
            let isSelected = selected !== null;
            if (isSelected) {
              el.removeAttribute('selected')
            } else {
              el.setAttribute('selected', 'selected')
            }
            updateVisText();
          })
      })
      updateVisText()
  });
  </script>


</body>
